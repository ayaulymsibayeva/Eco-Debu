<html xmlns:th = "http://www.thymeleaf.org"
      xmlns:layout = "http://ultraq.net.nz/thymeleaf/layout" layout:decorator = "layout/main.html"
      xmlns:sec = "http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>EcoDebut</title>

    <link rel="stylesheet" type="text/css" href="/style/button.css">

</head>
<body>
<div layout:fragment="site_content">
    <div class="container mt-4">
        <div class="row">
            <div class="col-6 mt-3" >

                <div class="row justify-content-md-left mt-3" th:hidden="${pictures.isEmpty()}" style="height: inherit">

                    <div class="col-2">
                            <div class="row-3 justify-content-md-center" th:each="pic:${pictures}" style="height: inherit">
                                <div class="card justify-content-md-center mt-1" th:id="${'card'+pic.id}"  style="width: 100%; height: inherit">
                                    <img  th:id="${pic.id}" th:data-id="${pic.id}" onmousemove="hover(this.getAttribute('data-id'))" onmouseleave="leave(this.getAttribute('data-id'))"  onclick="change(this.getAttribute('data-id'))" th:src="@{'/viewPicture?url='+${pic!=null?pic.url:'null'}}"  class="card-img-top" alt="..." style="height: inherit">
                                </div>
                            </div>
                    </div>

                    <div class="col-4">
                        <div class="card" style="width: 350px; height: inherit" >
                            <a id="details" style="height: inherit; width: 100px"  href="#" onclick="details()" data-toggle="modal" data-target="#staticBackdrop">
                                <img id="main-image" th:src="@{'/viewPicture?url='+${!pictures.isEmpty()?pictures.get(0).url:'null'}}" style="height: inherit; width: 400px"  class="card-img-top" alt="..."></a>
                        </div>
                    </div>

                </div>

            </div>

            <div class="col-6 mt-4">
                <div class="container-fluid">
                    <div  style="height: inherit">

                        <h6 style="font-weight: bolder; font-size: 20px" th:text="${item.name}"></h6>
                        <h6 class="mt-3" style="font-weight: bolder; font-size: 24px; font-family: 'Arial Black'" th:text="${item.price}+'kzt'"></h6>


                        <h6> Описание: </h6>
                        <p class="card-text" style="font-size: 90%" th:text="${item.description}"></p>

                        <div class="alert alert-danger" role="alert" th:hidden="${size_required_alert==null}">
                            <span>Выберите размер</span>
                        </div>
                        <h5> Размеры: </h5>
                        <div style="display: flex;flex-direction: row">
                            <div th:each="s : ${item.sizes}" style="margin-right: 40px; font-size: 20px">
                                <input th:id="${s.id}" th:data-id="${s.id}" onclick="onSizeChange(this.getAttribute('data-id'))" th:type="radio" style="margin-right: 5px" name="size_id" required/><label th:text="${' ' + s.name}"></label>
                            </div>
                        </div>

                        <p class="card-text" style="font-size: 90%" th:text="${item.addedDate.toLocaleString()}"></p>



                </div>


                    <div class="alert alert-danger" role="alert" 	th:hidden="${#request.getParameter('error')==null}">
                        <span >Incorrect email or password</span>
                    </div>

                    <form th:action="@{'/addToBasket'}" method="get" >
                        <input type="hidden" name="item_id" th:value="${item.id}">

                        <input required type="hidden" id="selected_size_id" name="size_id">
                        <button class="btn btn-primary mt-3 mb-2" sec:authorize="isAuthenticated()">  <span th:text="#{addToBusket}"></span></button>
                    </form>

                    <form th:action="@{'/addComment'}" method="post" sec:authorize="isAuthenticated()">
                        <input type="hidden" name="item_id" th:value="${item.id}">
                        <div class="form-group">
                            <textarea class="form-control" name="comment" style="min-height: 100px"></textarea>
                        </div>
                        <div class="form-group">
                        <button class="btn btn-outline-dark mb-2" th:text="#{addComment}"></button>
                        </div>
                    </form>

                    <ul class="list-group">
                        <li class="list-group-item" th:each="com:${comments}">
                            <div class="row">
                                <div class="col-9">
                                    <h4 th:text="${com.author.fullName}"></h4>
                                    <input type="hidden" th:id="${'comment_value_'+com.id}" th:value="${com.comment}">
                                    <span th:text="${com.comment}"></span>
                                </div>
                                <div class="col-3 float-right">
                                    <small><span style="font-size: 110%" th:text="${#dates.format(com.date, 'dd.MM.yyyy - HH:mm')}" class="float-right"></span></small><br/>
                                    <a th:href="@{'/deleteComment?id='+${com.id}}" sec:authorize="isAuthenticated()" th:hidden="${(current_user.id != com.author.id && current_user.roles.size()==1)}" class="btn btn-danger btn-sm float-right" style="margin-left: 5px"><img style="height: 15px;width: 15px" th:src="@{'/icons/trash.png'}"></a>
                                    <button sec:authorize="isAuthenticated()" th:hidden="${current_user.id != com.author.id}"   type="button" class="btn btn-dark btn-sm float-right" th:data-id="${com.id}"  onclick="EditComment(this.getAttribute('data-id'))"  data-toggle="modal" data-target="#Edit"><img style="height: 15px;width: 15px" th:src="@{'/icons/edit.png'}"></button>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>




        </div>









        <div class="modal fade" id="Edit" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form th:action="@{'/edit_Comment'}" method="post">
                    <div class="modal-header">
                        <h5 class="modal-title" th:text="#{editComment}"></h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>

                        <div class="modal-body">
                            <input type="hidden" name="id" id="id">
                            <div class="form-group">
                                <textarea class="form-control" id="comment_text" name="comment" style="min-height: 100px"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal" th:text="#{button.close}"></button>
                            <button class="btn btn-success" th:text="#{button.editItem}"></button>
                        </div>
                    </form>
                </div>
            </div>
        </div>






        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script>

            const change = (id) =>{
                $(document).ready(function(){
                    $(document.getElementById(id)).click(function(){
                        $("#main-image").attr("src", $(document.getElementById(id)).attr("src"));
                    });
                });
            }


        </script>


        <script>

            const details = () =>{
                $(document).ready(function(){
                    $("#details").click(function(){
                        $("#modal-picture").attr("src", $("#main-image").attr("src"));
                    });
                });
            }


        </script>



        <script>
            const hover = (id) => {
                $(document).ready(function () {
                    $(document.getElementById(id)).mousemove(function () {
                            $(document.getElementById("card"+id)).attr({"style":"border:solid black 2px;width: 80px;height: 100px;"});
                        }
                        );
                });
            }
        </script>

        <script>
            const leave = (id) => {
                $(document).ready(function () {
                    $(document.getElementById(id)).mouseleave(function () {
                            $(document.getElementById("card"+id)).attr({"style":""});
                        }
                    );
                });
            }
        </script>


        <script>

            const onSizeChange = (id) =>{
                console.log("nazhal");
                $(document).ready(function(){
                        $("#selected_size_id").attr("value", id);
                });
            }


        </script>





        <div class="modal fade" id="staticBackdrop" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content" style="width: 700px;height: 800px">
                    <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">Modal title</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">




                        <div id="carouselExampleInterval" class="carousel slide" data-ride="carousel">
                            <div class="carousel-inner">
                                <div class="carousel-item active selected" data-interval="10000">
                                    <img src="" id="modal-picture" class="d-block w-100" alt="...">
                                </div>
                                <div class="carousel-item" data-interval="10000" th:each="pic:${pictures}">
                                    <img th:src="@{'/viewPicture?url='+${pic!=null?pic.url:'null'}}" class="d-block w-100" alt="...">
                                </div>
                            </div>
                            <a class="carousel-control-prev" href="#carouselExampleInterval" role="button" data-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="sr-only">Previous</span>
                            </a>
                            <a class="carousel-control-next" href="#carouselExampleInterval" role="button" data-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="sr-only">Next</span>
                            </a>
                        </div>







<!--                        <img src="" id="modal-picture" class="card-img-top" alt="...">-->
                    </div>
                </div>
            </div>
        </div>


        <script>
            const EditComment = (id) =>{
                document.getElementById("id").value = id;
                document.getElementById("comment_text").value = document.getElementById("comment_value_"+id).value;


            }
        </script>



    </div>


</div>
</body>
</html>